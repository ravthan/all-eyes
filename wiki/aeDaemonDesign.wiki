#summary How to start the 'ae' daemon

'ae' daemon runs with root privileges.  It is a multi-threaded daemon.  The primary thread spawns and manages the monitors.  The second thread manaages SSL clients (i.e. AE Proxy).

'ae' daemon accepts two options.  With '-a' 'ae' daemon takes pre-configured actions (i.e. IGNORE or HALT the host).  If the daemon is invoked without -a option, it will operate in 'monitor only' mode.  With '-p' option, i.e. persistent mode, monitors may save data across service restart or system reboot.

= PROCEDURE FOR AE-DAEMON TO START UP A  MONITOR=

'ae' daemon spawns monitors.  If a monitor does not send regular heartbeat message or a status message within a specified period of time, then 'ae' daemon will kill the monitor.  The monitors are configured at the compile time with the daemon.  Based on the configuration, daemon calls corresponding monitor function after doing the following list of things:

    # 'fork' a new process
    # The ae-daemon creates a pair of SOCKET STREAM and re-directs the STDIN/STDOUT to the monitors
    # Clear out other monitor's details and closes the other monitor's socketpair's file descriptors.
    # Sets up the SIGCHLD signal to ignore.
    # Drops the privileges.  This step contains two parts: one is to change the root (/) to chroot-jail, and then do setuid to 'ae' user.
    # Marks the monitor has running and calls the monitor's C function.  Note that some monitors may exec a PERL/PYTHON/Java/RUBY (or any other language program) to implement a monitor.


The protocol between the ae-daemon and the monitor is defined in page http://code.google.com/p/all-eyes/wiki/AeMonitorProtocol?ts=1351811756&updated=AeMonitorProtocol

   # What the ae-daemon should check
       * The ae-daemon should kill and restart the monitor process if it hasn't received the message within 30 seconds after the monitor starts running.
       * The ae-daemon should kills and restart the monitor process if it received message does not confirm to the AeMonitorProtocl.
       * The ae-daemon kills and restarts the monitor, if the reestablished the SOCKET STREAM, communication is broken.