########################################################################
# File Name: socketmon_apparmor_prof
# Description:
#     This file contains the informamtion about the AppArmor profile
#     for protecting the socketmon.pl. You should apply the command
#     "sudo aa-genprof ./socketmon.pl" to generate a default profile
#     first and then compare the entries of the generated profile
#     with entries in this files
#
#     NOTE: The "mux" is used for /bin/netstat. This is necessary
#     because netstat performs a privileged operation in order
#     to obtain the process name
########################################################################

#include <tunables/global>

/home/toddchu/workdir/project/all-eyes/src/ae/socketmon/socketmon.pl {
  #include <abstractions/apache2-common>
  #include <abstractions/base>
  #include <abstractions/perl>
  #include <abstractions/nameservice>

  deny capability sys_ptrace,

  capability dac_override,
  capability dac_read_search,

  /bin/netstat mux,
  /etc/networks r,
  /home/toddchu/workdir/project/all-eyes/src/ae/lib/util.pl r,
  /home/toddchu/workdir/project/all-eyes/src/ae/socketmon/socketmon.pl r,
  /home/toddchu/workdir/project/all-eyes/src/ae/socketmon/socketmon_conf r,
  /proc/ r,
  /proc/*/cmdline r,
  /proc/*/fd/ r,
  /proc/*/net/raw r,
  /proc/*/net/raw6 r,
  /proc/*/net/tcp r,
  /proc/*/net/tcp6 r,
  /proc/*/net/udp r,
  /proc/*/net/udp6 r,
  /usr/bin/perl ix,
}
